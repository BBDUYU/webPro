<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>새총 공 던지기 게임</title>
<style>
    body {
        font-family: Arial, sans-serif;
        text-align: center;
        margin-top: 20px;
    }
    #scoreBoard {
        font-size: 20px;
        margin-bottom: 10px;
    }
    #gameArea {
        width: 600px;
        height: 400px;
        border: 2px solid #333;
        margin: 0 auto;
        position: relative;
        background-color: #f0f0f0;
        overflow: hidden;
    }
    .target {
        width: 50px;
        height: 50px;
        background-color: red;
        border-radius: 50%;
        position: absolute;
    }
    .ball {
        width: 30px;
        height: 30px;
        background-color: blue;
        border-radius: 50%;
        position: absolute;
        bottom: 20px;
        left: 50px;
        cursor: grab;
        touch-action: none;
        opacity: 1;
    }
    .line {
        position: absolute;
        width: 2px;
        background-color: black;
        transform-origin: top left;
        pointer-events: none;
    }
</style>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>

<h1>새총 공 던지기 게임</h1>
<div id="scoreBoard">점수: 0</div>
<div id="gameArea">
    <div class="target" style="top:100px; left:500px;"></div>
    <div class="ball"></div>
    <div class="line"></div>
</div>

<script>
$(function() {
    const $ball = $(".ball");
    const $target = $(".target");
    const $gameArea = $("#gameArea");
    const $scoreBoard = $("#scoreBoard");
    const $line = $(".line");

    let score = 0;
    let dragging = false;
    let startX, startY;
    let ballX = 50, ballY = 350;
    let velocityX = 0, velocityY = 0;
    const gravity = 0.5;
    let ballSize = 30;

    function resetBall() {
        ballX = 50;
        ballY = 350;
        velocityX = 0;
        velocityY = 0;
        ballSize = 30;
        $ball.css({
            left: ballX + "px",
            top: ballY + "px",
            width: ballSize + "px",
            height: ballSize + "px",
            opacity: 1
        });
    }

    function moveTarget() {
        const maxX = $gameArea.width() - $target.width();
        const maxY = $gameArea.height() - $target.height();
        const x = Math.floor(Math.random() * (maxX - 200) + 200);
        const y = Math.floor(Math.random() * maxY);
        $target.css({ left: x + "px", top: y + "px" });
    }

    function update() {
        if(!dragging && (velocityX !== 0 || velocityY !== 0)) {
            velocityY += gravity;
            ballX += velocityX;
            ballY += velocityY;

            // 원근감
            ballSize *= 0.995;

            $ball.css({
                left: ballX + "px",
                top: ballY + "px",
                width: ballSize + "px",
                height: ballSize + "px"
            });

            // 충돌 체크
            const ballCenterX = ballX + ballSize/2;
            const ballCenterY = ballY + ballSize/2;
            const targetOffset = $target.offset();
            const targetX = targetOffset.left - $gameArea.offset().left + $target.width()/2;
            const targetY = targetOffset.top - $gameArea.offset().top + $target.height()/2;

            const dx = ballCenterX - targetX;
            const dy = ballCenterY - targetY;
            const distance = Math.sqrt(dx*dx + dy*dy);
            if(distance < (ballSize/2 + $target.width()/2)) {
                score++;
                $scoreBoard.text("점수: " + score);
                moveTarget();
                resetBall();
            }

            // 바닥/벽 체크
            if(ballY + ballSize > $gameArea.height() || ballX + ballSize > $gameArea.width() || ballX < 0) {
                resetBall();
            }
        }
        requestAnimationFrame(update);
    }

    $ball.on("mousedown touchstart", function(e){
        dragging = true;
        const pageX = e.pageX || e.originalEvent.touches[0].pageX;
        const pageY = e.pageY || e.originalEvent.touches[0].pageY;
        startX = pageX;
        startY = pageY;
        $line.show();
        e.preventDefault();
    });

    $(document).on("mousemove touchmove", function(e){
        if(dragging){
            const pageX = e.pageX || e.originalEvent.touches[0].pageX;
            const pageY = e.pageY || e.originalEvent.touches[0].pageY;

            const dx = startX - pageX;
            const dy = startY - pageY;
            const distance = Math.sqrt(dx*dx + dy*dy);

            // 새총 라인 표시
            const angle = Math.atan2(dy, dx) * 180 / Math.PI;
            $line.css({
                width: distance + "px",
                left: ballX + ballSize/2 + "px",
                top: ballY + ballSize/2 + "px",
                transform: `rotate(${angle}deg)`
            });

            // 드래그 거리 -> 공 불투명도 (0.3 ~ 1)
            let opacity = 1 - Math.min(distance / 200, 0.7); // 최대 0.3까지 감소
            $ball.css("opacity", opacity);
        }
    });

    $(document).on("mouseup touchend", function(e){
        if(dragging){
            const pageX = e.pageX || (e.originalEvent.changedTouches ? e.originalEvent.changedTouches[0].pageX : 0);
            const pageY = e.pageY || (e.originalEvent.changedTouches ? e.originalEvent.changedTouches[0].pageY : 0);
            const dx = startX - pageX;
            const dy = startY - pageY;

            // 새총 속도 적용
            velocityX = dx / 10;
            velocityY = dy / 10;

            dragging = false;
            $line.hide();
            $ball.css("opacity", 1); // 발사 후 원래 불투명도 복원
        }
    });

    moveTarget();
    resetBall();
    update();
});
</script>

</body>
</html>
